/*!
 * moOde audio player (C) 2014 Tim Curtis
 * http://moodeaudio.org
 *
 * tsunamp player ui (C) 2013 Andrea Coiutti & Simone De Gregori
 * http://www.tsunamp.com
 *
 * This Program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3, or (at your option)
 * any later version.
 *
 * This Program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * 2020-MM-DD TC moOde 6.7.1
 *
*/
function debugLog(e){"1"==SESSION.json.debuglog&&console.log(Date.now()+": "+e)}function sendMpdCmd(e,t){"undefined"==typeof t&&(t=!0),$.ajax({type:"GET",url:"command/index.php?cmd="+e,async:t,cache:!1,success:function(){}})}function sendVolCmd(e,t,a,o){"undefined"==typeof a&&(a=""),"undefined"==typeof o&&(o=!1);var s;return $.ajax({type:e,url:"command/moode.php?cmd="+t,async:o,cache:!1,data:a,success:function(e){s=JSON.parse(e)},error:function(){s=!1}}),s}function engineMpd(){debugLog("engineMpd: state=("+MPD.json.state+")"),$.ajax({type:"GET",url:"engine-mpd.php?state="+MPD.json.state,async:!0,cache:!1,success:function(e){debugLog("engineMpd: success branch: data=("+e+")");try{MPD.json=JSON.parse(e)}catch(t){MPD.json.error=t}if("undefined"==typeof MPD.json.error)debugLog("engineMpd: idle_timeout_event=("+MPD.json.idle_timeout_event+")","state",MPD.json.state),UI.hideReconnect===!0&&hideReconnect(),""===MPD.json.idle_timeout_event,"changed: update"==MPD.json.idle_timeout_event?"undefined"!=typeof MPD.json.updating_db?$(".busy-spinner").show():$(".busy-spinner").hide():"changed: mixer"==MPD.json.idle_timeout_event?renderUIVol():"changed: player"==MPD.json.idle_timeout_event&&null==MPD.json.file?resetPlayCtls():renderUI(),engineMpd();else{if(debugLog("engineMpd: success branch: error=("+MPD.json.error+"), module=("+MPD.json.module+")"),"object"==typeof MPD.json.error){var a="undefined"==typeof MPD.json.error.code?"":" ("+MPD.json.error.code+")";"JSON Parse error: Unexpected EOF"!=MPD.json.error.message&&notify("mpderror",MPD.json.error.message+a)}else'Failed to open "ALSA bluetooth" (alsa); Failed to open ALSA device "btstream": No such device'==MPD.json.error?notify("mpderror","Failed to open ALSA bluetooth output, no such device or connection"):"SyntaxError: JSON Parse error: Unexpected EOF"==MPD.json.error?notify("mpderror","JSON Parse error: Unexpected EOF"):"Not seekable"==MPD.json.error||notify("mpderror",MPD.json.error);renderUI(),setTimeout(function(){engineMpd()},ENGINE_TIMEOUT)}},error:function(e){debugLog("engineMpd: error branch: data=("+JSON.stringify(e)+")"),setTimeout(function(){"error"==e.statusText&&0==e.readyState&&renderReconnect(),MPD.json.state="reconnect",engineMpd()},ENGINE_TIMEOUT)}})}function engineMpdLite(){debugLog("engineMpdLite: state=("+MPD.json.state+")"),$.ajax({type:"GET",url:"engine-mpd.php?state="+MPD.json.state,async:!0,cache:!1,success:function(e){debugLog("engineMpdLite: success branch: data=("+e+")");try{MPD.json=JSON.parse(e)}catch(t){MPD.json.error=t}"undefined"==typeof MPD.json.error?(debugLog("engineMpdLite: idle_timeout_event=("+MPD.json.idle_timeout_event+")"),UI.hideReconnect===!0&&hideReconnect(),"undefined"!=typeof MPD.json.updating_db?$(".busy-spinner").show():$(".busy-spinner").hide(),engineMpdLite()):setTimeout(function(){debugLog("engineMpd: success branch: error=("+MPD.json.error+"), module=("+MPD.json.module+")"),engineMpdLite()},ENGINE_TIMEOUT)},error:function(e){debugLog("engineMpdLite: error branch: data=("+JSON.stringify(e)+")"),setTimeout(function(){"error"==e.statusText&&0==e.readyState&&renderReconnect(),MPD.json.state="reconnect",engineMpdLite()},ENGINE_TIMEOUT)}})}function engineCmd(){var e;$.ajax({type:"GET",url:"engine-cmd.php",async:!0,cache:!1,success:function(t){switch(e=JSON.parse(t).split(","),e[0]){case"inpactive1":case"inpactive0":inpSrcIndicator(e[0],e[1]+' Input Active: <button class="btn volume-popup-btn" data-toggle="modal"><i class="fal fa-volume-up"></i></button><span id="inpsrc-preamp-volume"></span><br><a class="btn configure-renderer" href="inp-config.php">Input Source</a>');break;case"btactive1":case"btactive0":inpSrcIndicator(e[0],"Bluetooth Active"+e[1]+'<br><a class="btn configure-renderer" href="blu-config.php">BlueZ Config</a>');break;case"aplactive1":case"aplactive0":inpSrcIndicator(e[0],'Airplay Active<br><button class="btn disconnect-renderer" data-job="airplaysvc">disconnect</button>');break;case"spotactive1":case"spotactive0":inpSrcIndicator(e[0],'Spotify Active<br><button class="btn disconnect-renderer" data-job="spotifysvc">disconnect</button>');break;case"slactive1":case"slactive0":inpSrcIndicator(e[0],'Squeezelite Active<br><button class="btn disconnect-renderer" data-job="slsvc">turn off</button>');break;case"scnactive1":screenSaver(e[0]);break;case"libupd_done":$(".busy-spinner").hide(),loadLibrary()}engineCmd()},error:function(){setTimeout(function(){engineCmd()},ENGINE_TIMEOUT)}})}function engineCmdLite(){var e;$.ajax({type:"GET",url:"engine-cmd.php",async:!0,cache:!1,success:function(t){e=JSON.parse(t).split(","),"libregen_done"==e[0]&&($(".busy-spinner").hide(),loadLibrary()),engineCmdLite()},error:function(){setTimeout(function(){engineCmdLite()},ENGINE_TIMEOUT)}})}function inpSrcIndicator(e,t){if(UI.currentFile="blank","1"==e.slice(-1)){$("#inpsrc-indicator").css("display","block"),$("#inpsrc-msg").html(t);var a="disabled"==SESSION.json.mpdmixer?"0dB":SESSION.json.volknob;$("#inpsrc-preamp-volume").text(a)}else $("#inpsrc-msg").html(""),$("#inpsrc-indicator").css("display","")}function screenSaver(e){"block"==$("#inpsrc-indicator").css("display")||UI.mobile||"1"==e.slice(-1)&&($("#ss-coverart-url").html('<img class="coverart" src="'+MPD.json.coverurl+'" alt="Cover art not found">'),$("body").addClass("cv"),$("#lib-coverart-img").hide(),coverView=!0)}function renderReconnect(){debugLog("renderReconnect: UI.restart=("+UI.restart+")"),"restart"==UI.restart?$("#restart").show():"shutdown"==UI.restart?$("#shutdown").show():$("#reconnect").show(),$("#countdown-display, #m-countdown, #playbar-countdown").countdown("pause"),window.clearInterval(UI.knob),UI.hideReconnect=!0}function hideReconnect(){$("#reconnect, #restart, #shutdown").hide(),UI.hideReconnect=!1}function disableVolKnob(){"1"==SESSION.json.volmute,$("#volumedn, #volumeup, #volumedn-2, #volumeup-2").prop("disabled",!0),$("#volumeup, #volumedn, #volumedn-2, #volumeup-2, .volume-display").css("opacity",".3"),$(".volume-display div, #inpsrc-preamp-volume").text("0dB"),$(".volume-display").css("cursor","unset"),UI.mobile&&($("#mvol-progress").css("width","100%"),$(".repeat").show(),$(".volume-popup-btn").hide())}function resetPlayCtls(){$("#m-total, #playbar-total, #playbar-mtotal").html(updTimeKnob("0")),$(".play i").removeClass("fas fa-pause").addClass("fas fa-play"),$("#total").html(updTimeKnob("0")+("1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?'<i class="fas fa-caret-up countdown-caret"></i>':'<i class="fas fa-caret-down countdown-caret"></i>')),$(".playlist li.active ").removeClass("active"),refreshTimeKnob(),refreshTimer(0,0,MPD.json.state),$("#countdown-display, #m-countdown, #playbar-countdown, #playbar-mcount").html("00:00")}function renderUIVol(){debugLog("renderUIVol"),$.getJSON("command/moode.php?cmd=readcfgsystem",function(e){e===!1?console.log("renderUIVol(): No data returned from readcfgsystem"):SESSION.json=e,"disabled"==SESSION.json.mpdmixer?disableVolKnob():(SESSION.json.feat_bitmask&FEAT_UPNPSYNC&&"0"==SESSION.json.btactive&&"0"==SESSION.json.airplayactv&&"0"==SESSION.json.slsvc&&SESSION.json.volknob!=MPD.json.volume&&"0"==SESSION.json.volmute&&(SESSION.json.volknob=MPD.json.volume,$.post("command/moode.php?cmd=updcfgsystem",{volknob:SESSION.json.volknob})),$("#volume").val(SESSION.json.volknob).trigger("change"),$(".volume-display div, #inpsrc-preamp-volume").text(SESSION.json.volknob),$("#volume-2").val(SESSION.json.volknob).trigger("change"),$("#mvol-progress").css("width",SESSION.json.volknob+"%"),"1"==SESSION.json.volmute?$(".volume-display div, #inpsrc-preamp-volume").text("mute"):$(".volume-display div").text(SESSION.json.volknob))})}function renderUI(){debugLog("renderUI");if("Radio station"!=MPD.json.artist&&$("#songsList li").length>0)for(i=0;i<filteredSongs.length;i++)if(filteredSongs[i].title==MPD.json.title){$("#songsList .lib-entry-song .songtrack").removeClass("lib-track-highlight"),$("#lib-song-"+(i+1)+" .lib-entry-song .songtrack").addClass("lib-track-highlight");break}$.getJSON("command/moode.php?cmd=readcfgsystem",function(e){if(e===!1?console.log("renderUI(): No data returned from readcfgsystem"):SESSION.json=e,"disabled"==SESSION.json.mpdmixer?disableVolKnob():(UI.mobile&&$(".volume-popup-btn").show(),$("#volume").val(SESSION.json.volknob).trigger("change"),$(".volume-display div, #inpsrc-preamp-volume").text(SESSION.json.volknob),$("#volume-2").val(SESSION.json.volknob).trigger("change"),$("#mvol-progress").css("width",SESSION.json.volknob+"%"),"1"==SESSION.json.volmute?$(".volume-display div, #inpsrc-preamp-volume").text("mute"):$(".volume-display div").text(SESSION.json.volknob)),"play"==MPD.json.state?($(".play i").removeClass("fas fa-play").addClass("fas fa-pause"),$(".playlist li.active").removeClass("active"),$(".playlist li:nth-child("+(parseInt(MPD.json.song)+1)+")").addClass("active")):"pause"!=MPD.json.state&&"stop"!=MPD.json.state||$(".play i").removeClass("fas fa-pause").addClass("fas fa-play"),$("#total").html(updTimeKnob(MPD.json.time?MPD.json.time:0)+("Radio station"==MPD.json.artist?"":"1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?'<i class="fas fa-caret-up countdown-caret"></i>':'<i class="fas fa-caret-down countdown-caret"></i>')),$("#m-total, #playbar-total").html(updTimeKnob(MPD.json.time?MPD.json.time:0)),$("#playbar-mtotal").html("&nbsp;/&nbsp;"+updTimeKnob(MPD.json.time)),$("#playbar-total").text().length>5?$("#playbar-countdown, #m-countdown, #playbar-total, #m-total").addClass("long-time"):$("#playbar-countdown, #m-countdown, #playbar-total, #m-total").removeClass("long-time"),MPD.json.file!==UI.currentFile&&MPD.json.cover_art_hash!==UI.currentHash){if(debugLog(MPD.json.coverurl),$("#coverart-url").html('<img class="coverart" src="'+MPD.json.coverurl+'" data-adaptive-background="1" alt="Cover art not found">'),MPD.json.file){var t="Radio station"==MPD.json.artist?encodeURIComponent(MPD.json.coverurl.replace("imagesw/radio-logos","imagesw/radio-logos/thumbs")):"/imagesw/thmcache/"+encodeURIComponent($.md5(MPD.json.file.substring(0,MPD.json.file.lastIndexOf("/"))))+".jpg";$("#playbar-cover").html('<img src="'+t+'">')}else $("#playbar-cover").html('<img src="'+UI.defCover+'">');"Yes"==SESSION.json.cover_backdrop&&-1===MPD.json.coverurl.indexOf("default-cover-v6")?($("#cover-backdrop").html('<img class="ss-backdrop" src="'+MPD.json.coverurl+'">'),$("#cover-backdrop").css("filter","blur("+SESSION.json.cover_blur+")"),$("#cover-backdrop").css("transform","scale("+SESSION.json.cover_scale+")")):""!=SESSION.json.bgimage&&($("#cover-backdrop").html('<img class="ss-backdrop" src="'+SESSION.json.bgimage+'">'),$("#cover-backdrop").css("filter","blur(0px)"),$("#cover-backdrop").css("transform","scale(1.0)")),$("#ss-backdrop").html('<img class="ss-backdrop" src="'+MPD.json.coverurl+'">'),coverView&&$("#ss-coverart-url").html('<img class="coverart" src="'+MPD.json.coverurl+'" alt="Cover art not found">'),-1===MPD.json.coverurl.indexOf("default-cover-v6")?$.adaptiveBackground.run():setColors()}if("stop"===MPD.json.state)$("#extra-tags-display").html("Not playing");else if("none"==SESSION.json.extra_tags.toLowerCase()||""==SESSION.json.extra_tags)$("#extra-tags-display").html("");else if("Radio station"==MPD.json.artist)$("#extra-tags-display").html(MPD.json.bitrate?MPD.json.bitrate:"Variable bitrate");else{var a="";a=formatExtraTagsString(),a?$("#extra-tags-display").html(a):$("#extra-tags-display").html(MPD.json.audio_sample_depth+"/"+MPD.json.audio_sample_rate)}MPD.json.album?($("#currentalbum").html("Radio station"==MPD.json.artist?MPD.json.album:MPD.json.artist+" - "+MPD.json.album),$("#playbar-currentalbum, #ss-currentalbum").html("Radio station"==MPD.json.artist?-1!=MPD.json.file.indexOf("somafm")?RADIO.json[MPD.json.file].name:MPD.json.album:MPD.json.artist+" - "+MPD.json.album)):$("#currentalbum, #playbar-currentalbum, #ss-currentalbum").html(""),"Streaming source"===MPD.json.title||MPD.json.coverurl===UI.defCover||UI.mobile?$("#currentsong").html(MPD.json.title):$("#currentsong").html(genSearchUrl(MPD.json.artist,MPD.json.title,MPD.json.album)),$("#playbar-currentsong, #ss-currentsong").html(MPD.json.title),UI.currentSongId!=MPD.json.songid&&(toggleSongId="blank"==UI.currentSongId?SESSION.json.toggle_songid:UI.currentSongId,$.post("command/moode.php?cmd=updcfgsystem",{toggle_songid:toggleSongId})),UI.currentFile=MPD.json.file,UI.currentHash=MPD.json.cover_art_hash,UI.currentSongId=MPD.json.songid,"1"===MPD.json.consume?($(".consume").addClass("btn-primary"),$("#menu-check-consume").show()):($(".consume").removeClass("btn-primary"),$("#menu-check-consume").hide()),"1"===MPD.json.repeat?($(".repeat").addClass("btn-primary"),$("#menu-check-repeat").show()):($(".repeat").removeClass("btn-primary"),$("#menu-check-repeat").hide()),"1"===MPD.json.single?($(".single").addClass("btn-primary"),$("#menu-check-single").show()):($(".single").removeClass("btn-primary"),$("#menu-check-single").hide()),"1"===SESSION.json.ashufflesvc?"1"===SESSION.json.ashuffle?($(".random, .consume").addClass("btn-primary"),$("#songsList .lib-entry-song .songtrack").removeClass("lib-track-highlight")):$(".random").removeClass("btn-primary"):"1"===MPD.json.random?$(".random").addClass("btn-primary"):$(".random").removeClass("btn-primary"),"1"===SESSION.json.timecountup||0===parseInt(MPD.json.time)?refreshTimer(parseInt(MPD.json.elapsed),parseInt(MPD.json.time),MPD.json.state):refreshTimer(parseInt(MPD.json.time-parseInt(MPD.json.elapsed)),0,MPD.json.state),0!==parseInt(MPD.json.time)&&(UI.knobPainted=!1),"play"!==MPD.json.state&&"pause"!==MPD.json.state||UI.knobPainted!==!1||refreshTimeKnob(),"stop"===MPD.json.state&&refreshTimeKnob(),renderPlaylist(),"1"==SESSION.json.inpactive&&inpSrcIndicator("inpactive1",SESSION.json.audioin+' Input Active: <button class="btn volume-popup-btn" data-toggle="modal"><i class="fal fa-volume-up"></i></button><span id="inpsrc-preamp-volume"></span><br><a class="btn configure-renderer" href="inp-config.php">Input Source</a>'),"1"==SESSION.json.btactive&&inpSrcIndicator("btactive1",'Bluetooth Active<br><a class="btn configure-renderer" href="blu-config.php">BlueZ Config</a>'),"1"==SESSION.json.airplayactv&&inpSrcIndicator("aplactive1",'Airplay Active<br><button class="btn disconnect-renderer" data-job="airplaysvc">disconnect</button>'),"1"==SESSION.json.spotactive&&inpSrcIndicator("spotactive1",'Spotify Active<br><button class="btn disconnect-renderer" data-job="spotifysvc">disconnect</button>'),"1"==SESSION.json.slactive&&inpSrcIndicator("slactive1",'Squeezelite Active<br><button class="btn disconnect-renderer" data-job="slsvc">turn off</button>'),"undefined"!=typeof MPD.json.updating_db?$(".busy-spinner").show():$(".busy-spinner").hide()})}function genSearchUrl(e,t,a){var o="http://www.google.com/search?q=";if("undefined"==typeof e||"Radio station"===e){var s=t.replace(/-/g," ");s=s.replace(/&/g," "),s=s.replace(/\s+/g,"+")}else s=e+"+"+a;return'<a id="coverart-link" href="'+o+s+'" target="_blank">'+t+"</a>"}function renderPlaylist(){debugLog("renderPlaylist()"),$.getJSON("command/moode.php?cmd=playlist",function(e){var t="";if(UI.dbEntry[4]="undefined"==typeof e.length?0:e.length,e)for(i=0;i<e.length;i++){if(t+=i==parseInt(MPD.json.song)?'<li id="pl-'+(i+1)+'" class="active pl-entry">':'<li id="pl-'+(i+1)+'" class="pl-entry">',"undefined"!=typeof e[i].Name&&"m4a"==e[i].file.substr(e[i].file.lastIndexOf(".")+1).toLowerCase())t+='<span class="pl-action" data-toggle="context" data-target="#context-menu-playlist-item">'+("undefined"==typeof e[i].Time?"":formatSongTime(e[i].Time))+"<br><b>&hellip;</b></span>",t+='<span class="pll1">',t+=e[i].Name+"</span>",t+='<span class="pll2">',t+="undefined"==typeof e[i].Artist?"Unknown artist":e[i].Artist,t+=" - ",t+="undefined"==typeof e[i].Album?"Unknown album":e[i].Album;else if("undefined"!=typeof e[i].Name||"http"==e[i].file.substr(0,4)&&"undefined"==typeof e[i].Artist)if("undefined"==typeof e[i].Title||""==e[i].Title.trim()||"http://stream.radioactive.fm:8000/ractive"==e[i].file?(t+='<span class="pl-action" data-toggle="context" data-target="#context-menu-playlist-item">'+("undefined"==typeof e[i].Time?"":formatSongTime(e[i].Time))+"<br><b>&hellip;</b></span>",t+='<span class="pll1">Streaming source</span>'):(t+='<span class="pl-action" data-toggle="context" data-target="#context-menu-playlist-item">'+("undefined"==typeof e[i].Time?"":formatSongTime(e[i].Time))+"<br><b>&hellip;</b></span>",t+='<span class="pll1">'+e[i].Title+"</span>",i==parseInt(MPD.json.song)&&("http"===e[i].Title.substr(0,4)||MPD.json.coverurl===UI.defCover||UI.mobile?$("#currentsong").html(e[i].Title):$("#currentsong").html(genSearchUrl(e[i].Artist,e[i].Title,e[i].Album)),$("#ss-currentsong, #playbar-currentsong").html(e[i].Title))),t+='<span class="pll2">',t+='<i class="fas fa-microphone"></i> ',"undefined"==typeof RADIO.json[e[i].file]){var a="undefined"==typeof e[i].Name?"Radio station":e[i].Name;t+=a,i==parseInt(MPD.json.song)&&$("#playbar-currentalbum, #ss-currentalbum").html(a)}else t+=RADIO.json[e[i].file].name,i==parseInt(MPD.json.song)&&$("#playbar-currentalbum, #ss-currentalbum").html(RADIO.json[e[i].file].name);else{if(t+='<span class="pl-action" data-toggle="context" data-target="#context-menu-playlist-item">'+("undefined"==typeof e[i].Time?"":formatSongTime(e[i].Time))+"<br><b>&hellip;</b></span>",t+='<span class="pll1">',"undefined"==typeof e[i].Title){var o=e[i].file.lastIndexOf(".");if(-1==o)t+=e[i].file;else{var s=e[i].file.slice(0,o);o=s.lastIndexOf("/"),t+=s.slice(o+1)}t+="</span>"}else t+=e[i].Title+"</span>";t+='<span class="pll2">',t+="undefined"==typeof e[i].Artist?"Unknown artist":e[i].Artist,t+=" - ",t+="undefined"==typeof e[i].Album?"Unknown album":e[i].Album}t+="</span></div></li>"}$("#playlist ul").html(t),$("#cv-playlist ul").html(t),setTimeout(function(){$("#playback-panel").hasClass("active")&&(customScroll("pl",parseInt(MPD.json.song)),"block"==$("#cv-playlist").css("display")&&customScroll("pbpl",parseInt(MPD.json.song)))},SCROLLTO_TIMEOUT)})}function mpdDbCmd(e,t){var a=["add","play","clradd","clrplay","addall","playall","clrplayall","update_library"];UI.dbCmd=e,-1!=a.indexOf(e)?$.post("command/moode.php?cmd="+e,{path:t},function(){},"json"):"lsinfo"==e||"listsavedpl"==e?$.post("command/moode.php?cmd="+e,{path:t},function(e){renderBrowse(e,t)},"json"):"lsinfo_radio"==e&&0==radioRendering?$.post("command/moode.php?cmd=lsinfo",{path:t},function(e){renderRadio(e,t)},"json"):"delsavedpl"==e?($.post("command/moode.php?cmd="+e,{path:t},function(){},"json"),$.post("command/moode.php?cmd=lsinfo",{path:""},function(e){renderBrowse(e,"")},"json")):"newstation"==e||"updstation"==e?(RADIO.json[t.url]={name:t.display_name},$.post("command/moode.php?cmd="+e,{path:t},function(t){"OK"==t?notify(e):notify("validation_check",t,5e3),$("#ra-refresh").click()},"json")):"delstation"==e&&(deleteRadioStationObject(t.slice(0,t.lastIndexOf(".")).substr(6)),$.post("command/moode.php?cmd="+e,{path:t},function(){notify("delstation"),$("#ra-refresh").click()}))}function renderBrowse(e,t,a){UI.path=t;for(var o=[],s=[],r=[],n=0,i=0,l=0,c=0;c<e.length;c++)"undefined"!=typeof e[c].directory?(o[n]=e[c],n+=1):"undefined"!=typeof e[c].playlist?(s[i]=e[c],i+=1):(r[l]=e[c],l+=1);try{var d=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});"undefined"!=typeof o[0]&&o.sort(function(e,t){return e=-1==e.directory.lastIndexOf("/")?removeArticles(e.directory):removeArticles(e.directory.substr(e.directory.lastIndexOf("/")+1)),t=-1==t.directory.lastIndexOf("/")?removeArticles(t.directory):removeArticles(t.directory.substr(t.directory.lastIndexOf("/")+1)),d.compare(e,t)}),"undefined"!=typeof s[0]&&s.sort(function(e,t){return d.compare(removeArticles(e.playlist),removeArticles(t.playlist))}),"undefined"!=typeof r[0]&&-1!=r[0].file.indexOf("RADIO")&&r.sort(function(e,t){return d.compare(removeArticles(e.file.substring(6)),removeArticles(t.file.substring(6)))})}catch(p){"undefined"!=typeof o[0]&&o.sort(function(e,t){return e=-1==e.directory.lastIndexOf("/")?removeArticles(e.directory.toLowerCase()):removeArticles(e.directory.substr(e.directory.lastIndexOf("/")+1).toLowerCase()),t=-1==t.directory.lastIndexOf("/")?removeArticles(t.directory.toLowerCase()):removeArticles(t.directory.substr(t.directory.lastIndexOf("/")+1).toLowerCase()),e>t?1:t>e?-1:0}),"undefined"!=typeof s[0]&&s.sort(function(e,t){return e=removeArticles(e.playlist.toLowerCase()),t=removeArticles(t.playlist.toLowerCase()),e>t?1:t>e?-1:0}),"undefined"!=typeof r[0]&&-1!=r[0].file.indexOf("RADIO")&&r.sort(function(e,t){return e=removeArticles(e.file.substring(6).toLowerCase()),t=removeArticles(t.file.substring(6).toLowerCase()),e>t?1:t>e?-1:0})}e=o.concat(s).concat(r);var m=$("ul.database");if(m.html(""),$("#db-search-results").html(""),$("#db-search-results").hide(),$("#db-search-results").css("font-weight","normal"),a){var b=e.length?e.length:"0",u=1==e.length?"":"s",h=b+" item"+u;$("#db-search-results").show(),$("#db-search-results").html('<a href="#notarget" data-toggle="context" data-target="#context-menu-db-search-results">'+h+"</a>")}var g="";for(c=0;c<e.length;c++)g=formatBrowseData(e,t,c,"browse_panel"),m.append(g);customScroll("db",UI.dbPos[UI.dbPos[10]],100),""!=t&&UI.dbPos[UI.dbPos[10]]>1&&$("#db-"+UI.dbPos[UI.dbPos[10]].toString()).addClass("active")}function renderRadio(e,t){radioRendering=!0,UI.pathr=t;for(var a=[],o=[],s=0,r=0,n=0;n<e.length;n++)"undefined"!=typeof e[n].directory?(a[s]=e[n],s+=1):(o[r]=e[n],r+=1);try{var i=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});"undefined"!=typeof a[0]&&a.sort(function(e,t){return i.compare(removeArticles(e.directory.substring(6)),removeArticles(t.directory.substring(6)))}),"undefined"!=typeof o[0]&&o.sort(function(e,t){return i.compare(removeArticles(e.file.substring(6)),removeArticles(t.file.substring(6)))})}catch(l){"undefined"!=typeof a[0]&&a.sort(function(e,t){return e=removeArticles(e.directory.substring(6).toLowerCase()),t=removeArticles(t.directory.substring(6).toLowerCase()),e>t?1:t>e?-1:0}),"undefined"!=typeof o[0]&&o.sort(function(e,t){return e=removeArticles(e.file.substring(6).toLowerCase()),t=removeArticles(t.file.substring(6).toLowerCase()),e>t?1:t>e?-1:0})}e=a.concat(o);var c=$("ul.database-radio");c.html("");var d="";$(".btnlist-top-ra").show(),$("#searchResetRa").hide(),showSearchResetRa=!1,$("#ra-search-keyword").val(""),$("#ra-filter").val("");for(var p=GLOBAL.nativeLazyLoad?'<img loading="lazy" src="':'<img class="lazy-radioview" data-original="',n=0;n<e.length;n++)d+=formatBrowseData(e,t,n,"radio_panel",p);$("ul.database-radio").html(d),radioRendering=!1}function formatBrowseData(e,t,a,o,s){var r="";if(""==t&&"undefined"!=typeof e[a].file){var n=e[a].file.lastIndexOf("/");t=-1==n?"":e[a].file.slice(0,n)}if("undefined"!=typeof e[a].file){var i=e[a].file.substr(e[a].file.lastIndexOf(".")+1).toLowerCase();if("undefined"!=typeof e[a].Title)r='<li id="db-'+(a+1)+'" data-path="'+e[a].file+'">',r+='<div class="db-icon db-song db-action">',r+='<a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-folder-item">',r+='<i class="fas fa-music sx db-browse db-browse-icon"></i></a></div>',r+='<div class="db-entry db-song">'+e[a].Title+' <em class="songtime">'+e[a].TimeMMSS+"</em>",r+=" <span>"+e[a].Artist+" - "+e[a].Album+"</span></div></li>";else{r='<li id="db-'+(a+1)+'" data-path="';var l="";"http"==e[a].file.substr(0,4)?l=e[a].file:(cutpos=e[a].file.lastIndexOf("."),-1!=cutpos&&(l=e[a].file.slice(0,cutpos))),r+=e[a].file;var c="";if("RADIO"==e[a].file.substr(0,5)){if("radio_panel"==o){var d="../imagesw/radio-logos/thumbs/"+l.replace(t+"/","")+".jpg";r+='"><div class="db-icon db-song db-browse db-action">'+s+d+'"><div class="cover-menu" data-toggle="context" data-target="#context-menu-radio-item"></div></div><div class="db-entry db-song db-browse">'}else r+='"><div class="db-icon db-song db-browse db-action"><a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-radio-item"><i class="fas fa-microphone sx db-browse db-browse-icon"></i></a></div><div class="db-entry db-song db-browse">';c=""}else"cue"==i?(r+='"><div class="db-icon db-song db-browse db-action"><a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-folder-item"><i class="fas fa-list-ul icon-root sx db-browse-icon"></i></a></div><div class="db-entry db-song db-browse">',c="CUE sheet"):"http"==e[a].file.substr(0,4)?(r+='"><div class="db-icon db-song db-browse db-action"><a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-savedpl-item" style="width:100vw;height:2em;"><i class="fas fa-microphone sx db-browse db-browse-icon"></i></a></div><div class="db-entry db-song db-browse">',c="undefined"==typeof RADIO.json[e[a].file]?"Radio station":RADIO.json[e[a].file].name):(r+='"><div class="db-icon db-song db-browse db-action"><a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-savedpl-item" style="width:100vw;height:2em;"><i class="fas fa-music sx db-browse db-browse-icon"></i></a></div><div class="db-entry db-song db-browse">',c="Song file");r+=l.replace(t+"/",""),r+=" <span>",r+=c,r+="</span></div></li>"}}else"undefined"!=typeof e[a].playlist?"wv"==e[a].playlist.substr(e[a].playlist.lastIndexOf(".")+1).toLowerCase()?r="":(r='<li id="db-'+(a+1)+'" data-path="'+e[a].playlist+'">',r+='<div class="db-icon db-action">',r+='<a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-savedpl-root">',r+='<i class="fas fa-list-ul icon-root sx"></i></a></div>',r+='<div class="db-entry db-savedplaylist db-browse">'+e[a].playlist,r+="</div></li>"):"RADIO"!==e[a].directory&&(r='<li id="db-'+(a+1)+'" data-path="',r+=e[a].directory,r+=""!=t?"RADIO"==e[a].directory.substr(0,5)&&"radio_panel"==o?'"><div class="db-icon db-radiofolder-icon db-browse db-action"><img src="../images/radiofolder.jpg"></div><div class="db-entry db-radiofolder db-browse">':'"><div class="db-icon db-browse db-action"><a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-folder"><i class="fas fa-folder sx"></i></a></div><div class="db-entry db-folder db-browse">':'"><div class="db-icon db-action"><a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-folder"><i class="fas fa-hdd icon-root sx"></i></a></div><div class="db-entry db-folder db-browse">',r+=e[a].directory.replace(t+"/",""),r+="</div></li>");return r}function updTimeKnob(e){if("Radio station"==MPD.json.artist&&"undefined"==typeof MPD.json.duration){var t="";$("#total").html("").addClass("total-radio"),$("#playbar-mtime").css("display","block"),$("#playbar-mtotal").hide()}else{var t=formatSongTime(e);$("#total").removeClass("total-radio"),$("#playbar-mtime").css("display",""),$("#playbar-mtotal").show()}return t}function refreshTimer(e,t,a){$("#countdown-display, #m-countdown, #playbar-countdown, #playbar-mcount").countdown("destroy"),"play"==a||"pause"==a?("1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?($("#countdown-display").countdown({since:-e,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}),$("#m-countdown, #playbar-countdown, #playbar-mcount").countdown({since:-e,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"})):($("#countdown-display").countdown({until:e,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}),$("#m-countdown, #playbar-countdown, #playbar-mcount").countdown({until:e,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"})),"pause"==a&&$("#countdown-display, #m-countdown, #playbar-countdown, #playbar-mcount").countdown("pause")):"stop"==a&&("1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?($("#countdown-display").countdown({since:0,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}),$("#m-countdown, #playbar-countdown, #playbar-mcount").countdown({since:0,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"})):($("#countdown-display").countdown({until:0,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}),$("#m-countdown, #playbar-countdown, #playbar-mcount").countdown({until:0,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"})),$("#countdown-display, #m-countdown, #playbar-countdown, #playbar-mcount").countdown("pause"))}function refreshTimeKnob(){var e,t;if(window.clearInterval(UI.knob),e=parseInt(MPD.json.song_percent),t=parseInt(MPD.json.time)/1e3,UI.mobile?$("#timetrack").val(10*e).trigger("change"):-1!==currentView.indexOf("playback")?$("#time").val(10*e).trigger("change"):$("#playbar-timetrack").val(10*e).trigger("change"),"stop"===MPD.json.state?($("#countdown-display").countdown("destroy"),UI.mobile?($("#m-total, #m-countdown, #playbar-mcount").html("00:00"),$("#playbar-mtotal").html("&nbsp;/&nbsp;00:00")):$("#playbar-total, #playbar-countdown, #countdown-display").html("00:00")):"Radio station"==MPD.json.artist&&"undefined"==typeof MPD.json.duration?UI.mobile?$("#timeline").hide():($("#playbar-timeline").css("display","none"),$("#playbar-title").css("padding-bottom","0")):UI.mobile?$("#timeline").show():($("#playbar-timeline").show(),$("#playbar-title").css("padding-bottom","1rem")),"play"===MPD.json.state){var a=$("#timetrack"),o=($("playbar-#timetrack"),$("#time")),s=currentView.indexOf("playback");UI.knob=setInterval(function(){(UI.mobile||-1==s||1==coverView)&&(timeSliderMove||(syncTimers(),UI.mobile&&a.val(10*e).trigger("change"))),e+=0===t?.5:.1,UI.mobile||(0===t&&e>100&&(window.clearInterval(UI.knob),UI.knobPainted=!0),o.val(10*e).trigger("change"))},1e3*t)}}function formatSongTime(e){var t,a,o,s,r,n;return isNaN(parseInt(e))?t="":(a=Math.floor(e/3600),o=Math.floor(e/60),o=60>o?o:o%60,e%=60,s=a>0?a+":":"",r=10>o?"0"+o:o,n=10>e?"0"+e:e,t=s+r+":"+n),t}function formatTotalTime(e){var t,a,o,s,r;return isNaN(parseInt(e))?t="":(a=~~(e/3600),e%=3600,o=~~(e/60),s=0==a?"":1==a?a+" hour":a+" hours",r=0==o?"":1==o?o+" min":o+" mins",t=a>0?o>0?s+" "+r:s:r),formatNumCommas(t)}function formatNumCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function countdownRestart(e){$("#countdown-display, #m-countdown, #playbar-countdown, #playbar-mcount").countdown("destroy"),$("#countdown-display").countdown({since:e,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}),$("#m-countdown, #playbar-countdown, #playbar-mcount").countdown({since:e,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"})}function setVolume(e,t){e=parseInt(e),e=e>GLOBAL.mpdMaxVolume?GLOBAL.mpdMaxVolume:e,e=0>e?0:e,"0"==SESSION.json.volmute?(SESSION.json.volknob=e.toString(),sendVolCmd("POST","updvolume",{volknob:SESSION.json.volknob},!0)):(0==e&&"mute"==t?sendMpdCmd("setvol 0"):SESSION.json.volknob=e.toString(),$.post("command/moode.php?cmd=updcfgsystem",{volknob:SESSION.json.volknob}))}function customScroll(e,t,a){var o,s,r,n,i,l,c,d;if(a="undefined"==typeof a?200:a,"db"==e)o="#database",s=o,r=4;else if("pl"==e){if(isNaN(t))return;o="#playlist",s="#container-playlist",r=6}else if("pbpl"==e){if(isNaN(t))return;o="#cv-playlist",s=o,r=6}else"genres"==e?(o="#lib-genre",s=o,r=6):"artists"==e?(o="#lib-artist",s=o,r=6):"albums"==e||"albumcovers"==e?(o="albums"==e?"#lib-album":"#lib-albumcover",s=o,r=6,t="albums"==e?t:t+1):"tracks"==e?(o="#trackscontainer",s="#lib-file",r=600):"radio"==e&&(o="#database-radio",s=o,r=6);d=void 0!=$(o+" ul li:nth-child("+t+")").position()?$(o+" ul li:nth-child("+t+")").position().top:0,n=parseInt($(s).height()/r),i=$(s).scrollTop(),l=d+i-n,c=l>i?"+="+Math.abs(l-i)+"px":"-="+Math.abs(l-i)+"px",0==t?$(s).scrollTo(0,a):l>0?$(s).scrollTo(c,a):$(s).scrollTo(0,a)}function updateClockRadioCfgSys(){$.post("command/moode.php?cmd=updcfgsystem",{clkradio_mode:SESSION.json.clkradio_mode,clkradio_item:SESSION.json.clkradio_item.replace(/'/g,"''"),clkradio_name:SESSION.json.clkradio_name.replace(/'/g,"''"),clkradio_start:SESSION.json.clkradio_start,
clkradio_stop:SESSION.json.clkradio_stop,clkradio_volume:SESSION.json.clkradio_volume,clkradio_action:SESSION.json.clkradio_action},function(){$.get("command/moode.php?cmd=updclockradio")})}function setLibraryThumbnailCols(e){var t={6:"15vw,45vw",7:"13vw,30vw",8:"11vw,22vw"},a=t[e].split(",");document.body.style.setProperty("--thumbcols",a[0]),document.body.style.setProperty("--mthumbcols",a[1])}function importBgImage(e){if(e[0].size>1e6)return void $("#error-bgimage").text("Image must be less than 1MB in size");if("image/jpeg"!=e[0].type)return void $("#error-bgimage").text("Image format must be JPEG");$("#error-bgimage").text(""),UI.bgImgChange=!0,imgUrl=(URL||webkitURL).createObjectURL(e[0]),$("#current-bgimage").html("<img src='"+imgUrl+"' />"),$("#info-toggle-bgimage").css("margin-left","60px"),URL.revokeObjectURL(imgUrl);var t=new FileReader;t.onload=function(){var e=t.result,a=e.match(/,(.*)$/)[1];$.post("command/moode.php?cmd=setbgimage",{blob:a})},t.readAsDataURL(e[0])}function newLogoImage(e){if(e[0].size>1e6)return void $("#error-new-logoimage").text("Image must be less than 1MB in size");if("image/jpeg"!=e[0].type)return void $("#error-new-logoimage").text("Image format must be JPEG");$("#error-new-logoimage").text(""),imgUrl=(URL||webkitURL).createObjectURL(e[0]),$("#preview-new-logoimage").html("<img src='"+imgUrl+"' />"),$("#info-toggle-new-logoimage").css("margin-left","60px"),$("#new-station-tags").css("margin-top","30px");var t=$("#new-station-pls-name").val();URL.revokeObjectURL(imgUrl);var a=new FileReader;a.onload=function(){var e=a.result,o=e.match(/,(.*)$/)[1];$.post("command/moode.php?cmd=setlogoimage",{name:t,blob:o})},a.readAsDataURL(e[0])}function editLogoImage(e){if(e[0].size>1e6)return void $("#error-edit-logoimage").text("Image must be less than 1MB in size");if("image/jpeg"!=e[0].type)return void $("#error-edit-logoimage").text("Image format must be JPEG");$("#error-edit-logoimage").text(""),imgUrl=(URL||webkitURL).createObjectURL(e[0]),$("#preview-edit-logoimage").html("<img src='"+imgUrl+"' />"),$("#info-toggle-edit-logoimage").css("margin-left","60px");var t=$("#edit-station-pls-name").val();URL.revokeObjectURL(imgUrl);var a=new FileReader;a.onload=function(){var e=a.result,o=e.match(/,(.*)$/)[1];$.post("command/moode.php?cmd=setlogoimage",{name:t,blob:o})},a.readAsDataURL(e[0])}function importStationPkg(e){$("#import-export-msg").text("Importing..."),objUrl=(URL||webkitURL).createObjectURL(e[0]),URL.revokeObjectURL(objUrl);var t=new FileReader;t.onload=function(){var e=t.result,a=e.match(/,(.*)$/)[1];$.post("command/moode.php?cmd=import_stations",{blob:a},function(){$("#import-export-msg").text("Import complete"),$("#import-station-pkg").val("")})},t.readAsDataURL(e[0])}function setClkRadioCtls(e){"Disabled"==e?($("#clockradio-ctl-grp1 *").prop("disabled",!0),$("#clockradio-ctl-grp2 *").prop("disabled",!0),$("#clockradio-ctl-grp3 *").prop("disabled",!0)):"Sleep Timer"==e?($("#clockradio-ctl-grp1 *").prop("disabled",!0),$("#clockradio-ctl-grp2 *").prop("disabled",!1),$("#clockradio-ctl-grp3 *").prop("disabled",!0)):($("#clockradio-ctl-grp1 *").prop("disabled",!1),$("#clockradio-ctl-grp2 *").prop("disabled",!1),$("#clockradio-ctl-grp3 *").prop("disabled",!1))}function rgbToHsl(e){var t,a,o,e=e.substr(4),e=e.slice(0,e.length-1),s=e.split(","),r=s[0]/255,n=s[1]/255,i=s[2]/255,l=Math.min(r,n,i),c=Math.max(r,n,i),d=c-l;return c===l?t=0:r===c?t=(n-i)/d:n===c?t=2+(i-r)/d:i===c&&(t=4+(r-n)/d),t=Math.min(60*t,360),0>t&&(t+=360),o=(l+c)/2,a=c===l?0:.5>=o?d/(c+l):d/(2-c-l),t/=360,[t,a,o]}function hslToRgb(e){var t,a,o,s,r,n=e[0],i=e[1],l=e[2];if(0===i)return r=Math.round(255*l),[r,r,r];a=.5>l?l*(1+i):l+i-l*i,t=2*l-a,s=[0,0,0];for(var c=0;3>c;c++)o=n+1/3*-(c-1),0>o&&o++,o>1&&o--,r=1>6*o?t+6*(a-t)*o:1>2*o?a:2>3*o?t+(a-t)*(2/3-o)*6:t,s[c]=Math.round(255*r);return s}function hslToRgba(e,t){var a,o,s,r,n,i=e[0],l=e[1],c=e[2];if(0===l)return n=Math.round(255*c),[n,n,n];o=.5>c?c*(1+l):c+l-c*l,a=2*c-o,r=[0,0,0];for(var d=0;3>d;d++)s=i+1/3*-(d-1),0>s&&s++,s>1&&s--,n=1>6*s?a+6*(o-a)*s:1>2*s?o:2>3*s?a+(o-a)*(2/3-s)*6:a,r[d]=Math.round(255*n);var p="rgba(".concat(r[0],",",r[1],",",r[2],",",t,")");return p}function rgbaToRgb(e,t,a,o){var s=Math.round((1-e)*o[0]+e*a[0]),r=Math.round((1-e)*o[1]+e*a[1]),n=Math.round((1-e)*o[2]+e*a[2]),i="rgba("+s+", "+r+", "+n+", "+t+")";return i}function splitColor(e){var t=e.slice(5,e.length-1),a=t.split(","),o=a[0],s=a[1],r=a[2],n=a[3];return[o,s,r,n]}function splitRGB(e){var t=e.substr(4),t=t.slice(0,t.length-1),a=t.split(","),o=a[0],s=a[1],r=a[2];return[o,s,r]}function hexToRgb(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,a,o){return t+t+a+a+o+o});var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}function str2rgba(e){var t="rgba("+e+")";return t}function str2hex(e){var t="#"+e;return t}function dbFastSearch(){return $("#dbsearch-alltags").val($("#dbfs").val()),$("#db-search-submit").click(),!1}function btnbarfix(e,t){var a=splitColor(e),o=hexToRgb(t),s=0;if(SESSION.json.alphablend<.85&&(s=.9-SESSION.json.alphablend,s>.4&&(s=.4)),.15>s?tempy=.25:tempy=.1+s,document.body.style.setProperty("--btnbarcolor",getYIQ(e)>127?"rgba(32,32,32,"+tempy+")":"rgba(224,224,224,"+tempy+")"),tempcolor=rgbaToRgb(.7-s,"0.2",a,o),document.body.style.setProperty("--btnshade",tempcolor),tempcolor=rgbaToRgb(.8-s,"0.6",a,o),document.body.style.setProperty("--btnshade2",tempcolor),tempcolor=rgbaToRgb(.45,"1.0",a,o),document.body.style.setProperty("--textvariant",tempcolor),tempcolor=rgbaToRgb(.6,".7",a,o),document.body.style.setProperty("--btnshade3",tempcolor),document.body.style.setProperty("--btnshade4",getYIQ(e)>127?"rgba(32,32,32,0.10)":"rgba(208,208,208,0.17)"),$("#content").hasClass("visacc")?op=.95:op=.9,document.body.style.setProperty("--modalbkdr",rgbaToRgb(.95,op,a,o)),$("#content").hasClass("visacc"))-1==currentView.indexOf("playback")||"No"==SESSION.json.adaptive?UI.accenta=themeMcolor:UI.accenta=adaptMcolor;else{var r=hexToRgb(accentColor);UI.accenta=rgbaToRgb(.3-s,.75,a,r)}document.body.style.setProperty("--btnbarback",rgbaToRgb(.9,".9",a,o)),document.body.style.setProperty("--config_modal_btn_bg","rgba(128,128,128,0.12)")}function getYIQ(e){var t=e.match(/\d+/g);return parseInt((299*t[0]+587*t[1]+114*t[2])/1e3)}function setColors(){document.body.style.setProperty("--themebg",themeBack);var e=getYIQ(themeBack)>127;-1!==currentView.indexOf("playback")&&"Yes"==SESSION.json.adaptive?(e=getYIQ(adaptBack)>127,document.body.style.setProperty("--adaptbg",adaptBack),document.body.style.setProperty("--adapttext",adaptMcolor),document.body.style.setProperty("--adaptmbg",adaptMback),btnbarfix(adaptBack,adaptColor)):(document.body.style.setProperty("--adaptbg",themeBack),document.body.style.setProperty("--adapttext",themeMcolor),document.body.style.setProperty("--adaptmbg",themeMback),btnbarfix(themeBack,themeColor)),lastYIQ!==e&&(lastYIQ=e,e?(document.body.style.setProperty("--timethumb",'url("'+thumbd+'")'),document.body.style.setProperty("--fatthumb",'url("'+fatthumbd+'")'),document.body.style.setProperty("--timecolor","rgba(96,96,96,0.25)"),document.body.style.setProperty("--trackfill","rgba(48,48,48,1.0)"),document.body.style.setProperty("--radiobadge",'url("../images/radio-d.svg")'),setTimeout(function(){$(".playbackknob, .volumeknob").trigger("configure",{bgColor:"rgba(32,32,32,0.06)",fgColor:UI.accenta})},KNOBCOLOR_TIMEOUT)):(document.body.style.setProperty("--timethumb",'url("'+thumbw+'")'),document.body.style.setProperty("--fatthumb",'url("'+fatthumbw+'")'),document.body.style.setProperty("--timecolor","rgba(240,240,240,0.25)"),document.body.style.setProperty("--trackfill","rgba(240,240,240,1.0)"),document.body.style.setProperty("--radiobadge",'url("../images/radio-l.svg")'),setTimeout(function(){$(".playbackknob, .volumeknob").trigger("configure",{bgColor:"rgba(224,224,224,0.09)",fgColor:UI.accenta})},KNOBCOLOR_TIMEOUT)))}function updEqgFreq(e,t){$(e).html(t)}function updEqpMasterGain(e,t){$(e).html(t+" dB")}function updEqpFreq(e,t,a){$(e).html(a+" Hz"),$(t).val(a)}function updEqpMasterGainSlider(e){var t="master-gain-up"==e?.1:-.1,a=(parseFloat($("#master-gain-slider").val())+t).toFixed(1);a=a>24?24:-24>a?-24:a,$("#master-gain-slider").val(a),$("#master-gain").html(a+" dB")}function getCSSRule(e){for(var t=0;t<document.styleSheets.length;t++)for(var a=document.styleSheets[t],o=a.cssRules,s=0;s<o.length;s++){var r=o[s];if(r.selectorText==e)return r}}function themeToColors(e){switch(e){case"Amethyst":var t="#8e44ad",a="rgba(142,68,173,0.71)";break;case"Bluejeans":var t="#1a439c",a="rgba(26,67,156,0.71)";break;case"Carrot":var t="#d35400",a="rgba(211,84,0,0.71)";break;case"Emerald":var t="#27ae60",a="rgba(39,174,96,0.71)";break;case"Fallenleaf":var t="#cb8c3e",a="rgba(203,140,62,0.71)";break;case"Grass":var t="#7ead49",a="rgba(126,173,73,0.71)";break;case"Herb":var t="#317589",a="rgba(49,117,137,0.71)";break;case"Lavender":var t="#876dc6",a="rgba(135,109,198,0.71)";break;case"River":var t="#2980b9",a="rgba(41,128,185,0.71)";break;case"Rose":var t="#c1649b",a="rgba(193,100,155,0.71)";break;case"Silver":var t="#999999",a="rgba(153,153,153,0.71)";break;case"Turquoise":var t="#16a085",a="rgba(22,160,133,0.71)";break;default:var t="#c0392b",a="rgba(192,57,43,0.71)"}return document.body.style.setProperty("--accentxts",t),document.body.style.setProperty("--accentxta",a),t}function listLook(e,t,a){alphabitsFilter=0,"#"!=a&&$("#"+e).each(function(){var e=removeArticles($(this).text().toLowerCase());return e.substr(0,1)==a?!1:void alphabitsFilter++}),alphabitsFilter!=$("#"+e).length&&customScroll(t,alphabitsFilter,100)}function storeRadioPos(e){$.post("command/moode.php?cmd=updcfgsystem",{radio_pos:e})}function storeLibPos(e){$.post("command/moode.php?cmd=updcfgsystem",{lib_pos:e[0]+","+e[1]+","+e[2]})}function syncTimers(){var e=$("#countdown-display").text();if(e!=GLOBAL.lastTimeCount){if(UI.mobile)$("#m-countdown").text(e),$("#playbar-mcount").text(e);else if(coverView||-1==currentView.indexOf("playback")){$("#playbar-countdown").text(e);var t=e.split(":"),a=$("#playbar-total").text().split(":");switch(t.length){case 1:var o=parseInt(t[0]);break;case 2:var o=parseInt(60*t[0])+parseInt(t[1]);break;case 3:var o=parseInt(3600*t[0])+parseInt(60*t[1])+parseInt(t[2])}switch(a.length){case 1:var s=parseInt(a[0]);break;case 2:var s=parseInt(60*a[0])+parseInt(a[1]);break;case 3:var s=parseInt(3600*a[0])+parseInt(60*a[1])+parseInt(a[2])}"1"==SESSION.json.timecountup?g=o/s*100:g=100-o/s*100,$("#playbar-timetrack").val(10*g),g<50?g="calc("+g+"% + 2px)":g="calc("+g+"% - 2px)",$("#playbar-timeline .timeline-progress").css("width",g.toString())}else UI.knobPainted=!1;GLOBAL.lastTimeCount=e}}function makeActive(e,t,a){switch(UI.mobile&&($("#playback-controls").css("display",""),$("#content").css("height","100vh")),$("#content .tab-pane, .viewswitch button").removeClass("active"),$(e+","+t).addClass("active"),$.post("command/moode.php?cmd=updcfgsystem",{current_view:a}),currentView=a,setColors(),setLibMenuHeader(),$("#viewswitch span.pane").hide(),a){case"radio":lazyLode("radio"),$("#viewswitch-search, #viewswitch .view-all, #viewswitch .view-recents").hide(),$("#viewswitch .album-view-btn").removeClass("menu-separator"),$(".radio-view-btn .pane").show();break;case"folder":$("#viewswitch-search, #viewswitch .view-all, #viewswitch .view-recents").hide(),$("#viewswitch .album-view-btn").removeClass("menu-separator"),$(".folder-view-btn .pane").show();break;case"album":lazyLode("album"),$("#viewswitch-search, #viewswitch .view-all, #viewswitch .view-recents").show(),$("#viewswitch .album-view-btn").addClass("menu-separator"),$(".album-view-btn .pane").show(),$("#library-panel").addClass("covers").removeClass("tag"),$("#bottom-row").css("display",""),$("#lib-albumcover").css("height","100%");break;case"tag":lazyLode("tag"),$("#viewswitch-search, #viewswitch .view-all, #viewswitch .view-recents").show(),$("#viewswitch .album-view-btn").addClass("menu-separator"),$(".tag-view-btn .pane").show(),$("#library-panel").addClass("tag").removeClass("covers"),"Yes"==SESSION.json.library_show_genres?$("#top-columns").removeClass("nogenre"):$("#top-columns").addClass("nogenre")}}function setLibMenuHeader(){var e=UI.mobile?"":"Browse by ";"radio"==currentView?(e+="Radio Stations",GLOBAL.searchRadio&&(e=GLOBAL.searchRadio)):"folder"==currentView?(e+="Folders",GLOBAL.searchFolder&&(e=GLOBAL.searchFolder)):"album"!=currentView&&"tag"!=currentView||(GLOBAL.searchLib&&"all"==GLOBAL.musicScope?e=GLOBAL.searchLib:(e+="album"==currentView?SESSION.json.library_albumview_sort:SESSION.json.library_tagview_sort,$(".view-recents span").hide(),$(".view-all span").hide(),"recent"==GLOBAL.musicScope?($(".view-recents span").show(),LIB.recentlyAddedClicked=!0,e="Recently Added ("+getParamOrValue("param",SESSION.json.library_recently_added)+")"):($(".view-all span").show(),LIB.recentlyAddedClicked=!1),LIB.filters.genres.length&&(e="Browse "+LIB.filters.genres[0]),LIB.filters.artists.length&&(e="Albums by "+LIB.filters.artists[0]))),$("#menu-header").text(e)}function lazyLode(e){if(!GLOBAL.nativeLazyLoad){var t,a;switch(e){case"radio":a="img.lazy-radioview",t="#radiocovers";break;case"tag":"Yes"==SESSION.json.library_tagview_covers&&(a="img.lazy-tagview",t="#lib-album");break;case"album":a="img.lazy-albumview",t="#lib-albumcover"}a&&t&&setTimeout(function(){$(a).lazyload({container:$(t)})},LAZYLOAD_TIMEOUT)}}function setFontSize(){var e=getParamOrValue("value",SESSION.json.font_size);UI.mobile&&(e+=.3),document.body.style.setProperty("--pbfont","calc("+e+"rem + 1vmin)")}function volMuteSwitch(){if("0"==SESSION.json.volmute){SESSION.json.volmute="1";var e=0,t="mute"}else{SESSION.json.volmute="0";var e=SESSION.json.volknob,t="unmute"}$.post("command/moode.php?cmd=updcfgsystem",{volmute:SESSION.json.volmute},function(){setVolume(e,t)})}function submitLibraryUpdate(e){0==GLOBAL.libLoading?(GLOBAL.libLoading=!0,GLOBAL.libRendered=!1,mpdDbCmd("update_library",e),notify("update_library",e)):notify("library_updating")}const FEAT_KERNEL=1,FEAT_AIRPLAY=2,FEAT_MINIDLNA=4,FEAT_MPDAS=8,FEAT_SQUEEZELITE=16,FEAT_UPMPDCLI=32,FEAT_SQSHCHK=64,FEAT_GMUSICAPI=128,FEAT_LOCALUI=256,FEAT_INPSOURCE=512,FEAT_UPNPSYNC=1024,FEAT_SPOTIFY=2048,FEAT_GPIO=4096,FEAT_DJMOUNT=8192,FEAT_BLUETOOTH=16384,LAZYLOAD_TIMEOUT=250,SCROLLTO_TIMEOUT=250,KNOBCOLOR_TIMEOUT=250,LIBSEARCH_TIMEOUT=250,RASEARCH_TIMEOUT=750,PLSEARCH_TIMEOUT=750,PHSEARCH_TIMEOUT=750,RALBUM_TIMEOUT=1500,CLRPLAY_TIMEOUT=500,ENGINE_TIMEOUT=3e3;var UI={knob:null,path:"",pathr:"",restart:"",currentFile:"blank",currentHash:"blank",currentSongId:"blank",defCover:"images/default-cover-v6.svg",knobPainted:!1,chipOptions:"",hideReconnect:!1,bgImgChange:!1,clientIP:"",dbPos:[0,0,0,0,0,0,0,0,0,0,0],dbEntry:["","","","",""],dbCmd:"",raFolderLevel:[0,0,0,0,0],libPos:[-1,-1,-1],radioPos:-1,libAlbum:"",mobile:!1},MPD={json:0},SESSION={json:0},RADIO={json:0},THEME={json:0},NETWORK={json:0},GLOBAL={musicScope:"all",searchLib:"",searchRadio:"",searchFolder:"",scriptSection:"panels",regExIgnoreArticles:"",libRendered:!1,libLoading:!1,playbarPlaylistTimer:"",plActionClicked:!1,mpdMaxVolume:0,lastTimeCount:0,editStationId:"",nativeLazyLoad:!1},timeSliderMove=!1,themeColor,themeBack,themeMcolor,tempcolor,themeOp,themeMback,adaptColor,adaptBack,adaptMhalf,adaptMcolor,adaptMback,tempback,accentColor,abFound,showMenuTopW,showMenuTopR,thumbw="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='13' height='20'><circle fill='%23f0f0f0' cx='6.5' cy='10' r='3.5'/></svg>",thumbd="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='13' height='20'><circle fill='%23303030' cx='6.5' cy='10' r='3.5'/></svg>",fatthumbw="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='13' height='20'><circle fill='%23f0f0f0' cx='6.5' cy='10' r='5.5'/></svg>",fatthumbd="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='13' height='20'><circle fill='%23303030' cx='6.5' cy='10' r='5.5'/></svg>",blurrr=CSS.supports("-webkit-backdrop-filter","blur(1px)"),radioRendering=!1,dbFilterResults=[],searchTimer="",showSearchResetPl=!1,showSearchResetLib=!1,showSearchResetRa=!1,showSearchResetPh=!1,eqGainUpdInterval="",toolbarTimer="",toggleSongId="blank",currentView="playback",alphabitsFilter,lastYIQ="",coverView=!1;$('input[type="range"]').change(function(){var e=($(this).val()-$(this).attr("min"))/($(this).attr("max")-$(this).attr("min"))*100;50>e?e+=1:e-=1,$(".timeline-progress").css("width",e+"%")}),$("#timetrack, #playbar-timetrack").bind("touchstart mousedown",function(){timeSliderMove=!0,$("#m-countdown, #playbar-countdown, #playbar-mcount").countdown("pause")}),$("#timetrack, #playbar-timetrack").bind("touchend mouseup",function(){var e,t;t=parseInt(MPD.json.time),e=t/1e3;var a=Math.floor($(this).val()*e);a>t-2&&(a=t-2),sendMpdCmd("seek "+MPD.json.song+" "+a),timeSliderMove=!1}),$("#currentsong").click(function(){if(UI.mobile){var e,t,a,o,s=parseInt(MPD.json.song);o=$("#playlist ul li:nth-child("+(s+1)+")").position().top,e=parseInt($("#playlist").height()/3),t=$("#playlist").scrollTop(),a=o+200,$("html, body").animate({scrollTop:a},"fast")}}),$(".view-all").click(function(){$(".view-recents span").hide(),$(".view-all span").show(),$("#menu-header").click(),GLOBAL.musicScope="all",GLOBAL.searchLib,GLOBAL.searchRadio=!1,LIB.recentlyAddedClicked=!1,LIB.filters.albums.length=0,LIB.filters.year.length=0,UI.libPos.fill(-2),filterLib(),renderAlbums(),storeLibPos(UI.libPos),$("#searchResetLib").hide(),showSearchResetLib=!1,setLibMenuHeader()}),$(".view-recents").click(function(){GLOBAL.musicScope="recent",$(".view-all span").hide(),$(".view-recents span").show(),LIB.recentlyAddedClicked=!0,LIB.filters.albums.length=0,LIB.filters.year.length=0,UI.libPos.fill(-2),filterLib(),renderAlbums(),storeLibPos(UI.libPos),$("#searchResetLib").hide(),showSearchResetLib=!1,$("#menu-header").text("Recently Added ("+getParamOrValue("param",SESSION.json.library_recently_added)+")")}),$(".context-menu a").click(function(){var e=UI.dbEntry[0];if("add"==$(this).data("cmd"))mpdDbCmd("add",e),notify("add");else if("play"==$(this).data("cmd"))mpdDbCmd("play",e);else if("clradd"==$(this).data("cmd"))mpdDbCmd("clradd",e),notify("clradd"),-1==e.indexOf("/")&&"NAS"!=e&&"RADIO"!=e&&"SDCARD"!=e?$("#pl-saveName").val(e):$("#pl-saveName").val("");else if("clrplay"==$(this).data("cmd"))mpdDbCmd("clrplay",e),notify("clrplay"),-1==e.indexOf("/")&&"NAS"!=e&&"RADIO"!=e&&"SDCARD"!=e?$("#pl-saveName").val(e):$("#pl-saveName").val("");else if("update_folder"==$(this).data("cmd"))submitLibraryUpdate(e);else if("update_library"==$(this).data("cmd"))submitLibraryUpdate();else if("track_info_folder"==$(this).data("cmd"))$.post("command/moode.php?cmd=track_info",{path:e},function(e){$("#track-info-text").html(e),$("#track-info-modal").modal()},"json");else if("delsavedpl"==$(this).data("cmd"))$("#savedpl-path").html(e),$("#deletesavedpl-modal").modal();else if("editradiostn"==$(this).data("cmd"))$.post("command/moode.php?cmd=readstationfile",{path:UI.dbEntry[0]},function(t){var a=e.slice(e.lastIndexOf("/")+1);a=a.slice(0,a.lastIndexOf(".")),GLOBAL.editStationId=t.id,$("#edit-station-pls-name").val(a),$("#edit-station-url").val(t.station),$("#edit-logoimage").val(""),$("#info-toggle-edit-logoimage").css("margin-left","60px"),$("#preview-edit-logoimage").html('<img src="../imagesw/radio-logos/thumbs/'+a+'.jpg">'),$("#edit-station-tags").css("margin-top","30px"),$("#edit-station-display-name").val(t.name),$("#edit-station-genre").val(t.genre),$("#edit-station-broadcaster").val(t.broadcaster),$("#edit-station-language").val(t.language),$("#edit-station-country").val(t.country),$("#edit-station-region").val(t.region),$("#edit-station-bitrate").val(t.bitrate),$("#edit-station-format").val(t.format),$("#editstation-modal").modal()},"json");else if("delstation"==$(this).data("cmd"))$("#station-path").html(e.slice(0,e.lastIndexOf(".")).substr(6)),$("#deletestation-modal").modal();else if("deleteplitem"==$(this).data("cmd"))$("#delete-plitem-begpos").attr("max",UI.dbEntry[4]),$("#delete-plitem-endpos").attr("max",UI.dbEntry[4]),$("#delete-plitem-newpos").attr("max",UI.dbEntry[4]),$("#delete-plitem-begpos").val(e+1),$("#delete-plitem-endpos").val(e+1),$("#deleteplitems-modal").modal();else if("moveplitem"==$(this).data("cmd"))$("#move-plitem-begpos").attr("max",UI.dbEntry[4]),$("#move-plitem-endpos").attr("max",UI.dbEntry[4]),$("#move-plitem-newpos").attr("max",UI.dbEntry[4]),$("#move-plitem-begpos").val(e+1),$("#move-plitem-endpos").val(e+1),$("#move-plitem-newpos").val(e+1),$("#moveplitems-modal").modal();else if("setforclockradio"==$(this).data("cmd")||"setforclockradio-m"==$(this).data("cmd")){"setforclockradio-m"==$(this).data("cmd")&&$("#configure-modal").modal("toggle"),$("#clockradio-mode span").text(SESSION.json.clkradio_mode),"setforclockradio-m"==$(this).data("cmd")?($("#clockradio-playname").val(SESSION.json.clkradio_name),UI.dbEntry[0]="-1"):$("#clockradio-playname").val(UI.dbEntry[3]);var t=SESSION.json.clkradio_start.split(",");$("#clockradio-starttime-hh").val(t[0]),$("#clockradio-starttime-mm").val(t[1]),$("#clockradio-starttime-ampm span").text(t[2]),$("#clockradio-start-mon").prop("checked","1"==t[3]),$("#clockradio-start-tue").prop("checked","1"==t[4]),$("#clockradio-start-wed").prop("checked","1"==t[5]),$("#clockradio-start-thu").prop("checked","1"==t[6]),$("#clockradio-start-fri").prop("checked","1"==t[7]),$("#clockradio-start-sat").prop("checked","1"==t[8]),$("#clockradio-start-sun").prop("checked","1"==t[9]);var a=SESSION.json.clkradio_stop.split(",");$("#clockradio-stoptime-hh").val(a[0]),$("#clockradio-stoptime-mm").val(a[1]),$("#clockradio-stoptime-ampm span").text(a[2]),$("#clockradio-stop-mon").prop("checked","1"==a[3]),$("#clockradio-stop-tue").prop("checked","1"==a[4]),$("#clockradio-stop-wed").prop("checked","1"==a[5]),$("#clockradio-stop-thu").prop("checked","1"==a[6]),$("#clockradio-stop-fri").prop("checked","1"==a[7]),$("#clockradio-stop-sat").prop("checked","1"==a[8]),$("#clockradio-stop-sun").prop("checked","1"==a[9]),$("#clockradio-action span").text(SESSION.json.clkradio_action),$("#clockradio-volume").val(SESSION.json.clkradio_volume),setClkRadioCtls(SESSION.json.clkradio_mode),$("#clockradio-modal").modal()}else if("appearance"==$(this).data("cmd")){bgImgChange=!1;for(var o=SESSION.json.appearance_modal_state.split(","),s=0;4>s;s++)"1"==o[s]&&($("#appearance-modal div.control-group").eq(s).show(),$("#appearance-modal .accordian .dtopen").eq(s).show(),$("#appearance-modal .accordian .dtclose").eq(s).hide());$("#theme-name span").text(SESSION.json.themename),$.post("command/moode.php?cmd=readthemename",function(e){var t="";for(i=0;i<e.length;i++)t+='<li class="modal-dropdown-text"><a href="#notarget" data-cmd="theme-name-sel" style="background-color: rgb('+e[i].bg_color+')"><span class="text" style="color: #'+e[i].tx_color+'">'+e[i].theme_name+"</span></a></li>";$("#theme-name-list").html(t),$("#alpha-blend span").text(SESSION.json.alphablend),$("#adaptive-enabled span").text(SESSION.json.adaptive),$("#accent-color span").text(SESSION.json.accent_color),$("#error-bgimage").text(""),$.ajax({url:"imagesw/bgimage.jpg",type:"HEAD",success:function(){$("#remove-bgimage").show(),$("#choose-bgimage").hide(),$("#current-bgimage").html('<img src="imagesw/bgimage.jpg">'),$("#info-toggle-bgimage").css("margin-left","60px")},error:function(){$("#remove-bgimage").hide(),$("#choose-bgimage").show(),$("#current-bgimage").html(""),$("#info-toggle-bgimage").css("margin-left","5px")}}),$("#cover-backdrop-enabled span").text(SESSION.json.cover_backdrop),$("#cover-blur span").text(SESSION.json.cover_blur),$("#cover-scale span").text(SESSION.json.cover_scale),$("#instant-play-action span").text(SESSION.json.library_instant_play),$("#show-genres-column span").text(SESSION.json.library_show_genres),$("#show-tagview-covers span").text(SESSION.json.library_tagview_covers),$("#show-encoded-at span").text(getParamOrValue("param",SESSION.json.library_encoded_at)),$("#ellipsis-limited-text span").text(SESSION.json.library_ellipsis_limited_text),$("#thumbnail-columns span").text(SESSION.json.library_thumbnail_columns),$("#albumview-sort-order span").text("by "+SESSION.json.library_albumview_sort),$("#tagview-sort-order span").text("by "+SESSION.json.library_tagview_sort),$("#compilation-identifier").val(SESSION.json.library_comp_id),$("#recently-added span").text(getParamOrValue("param",SESSION.json.library_recently_added)),$("#ignore-articles").val(SESSION.json.library_ignore_articles),$("#utf8-char-filter span").text(SESSION.json.library_utf8rep),$("#hires-thumbnails span").text(SESSION.json.library_hiresthm),$("#cover-search-priority span").text(getParamOrValue("param",SESSION.json.library_covsearchpri)),$("#scnsaver-timeout span").text(getParamOrValue("param",SESSION.json.scnsaver_timeout)),$("#scnsaver-style span").text(SESSION.json.scnsaver_style),$("#font-size span").text(SESSION.json.font_size),$("#ashuffle-filter").val(SESSION.json.ashuffle_filter),$("#play-history-enabled span").text(SESSION.json.playhist),$("#extra-tags").val(SESSION.json.extra_tags),$("#appearance-modal").modal()},"json")}else"scnsaver"==$(this).data("cmd")?screenSaver("1"):"viewplayhistory"==$(this).data("cmd")?$.getJSON("command/moode.php?cmd=readplayhistory",function(e){var t="";for(i=1;i<e.length;i++)t+=e[i];$("ol.playhistory").html(t),$("#playhistory-modal").modal()}):"quickhelp"==$(this).data("cmd")?($("#quickhelp").load("quickhelp.html"),$("#quickhelp-modal").modal()):"aboutmoode"==$(this).data("cmd")&&($("#sys-raspbian-ver").text(SESSION.json.raspbianver),$("#sys-kernel-ver").text(SESSION.json.kernelver),$("#sys-processor-arch").text(SESSION.json.procarch),$("#sys-hardware-rev").text(SESSION.json.hdwrrev),$("#sys-mpd-ver").text(SESSION.json.mpdver),$("#about-modal").modal());"db-"==UI.dbEntry[3].substr(0,3)&&$("#"+UI.dbEntry[3]).removeClass("active")}),$(".btn-clockradio-update").click(function(){var e,t,a,o,s,r;SESSION.json.clkradio_mode=$("#clockradio-mode span").text(),SESSION.json.clkradio_name=$("#clockradio-playname").val(),e=1==$("#clockradio-starttime-hh").val().length?"0"+$("#clockradio-starttime-hh").val():$("#clockradio-starttime-hh").val(),t=1==$("#clockradio-starttime-mm").val().length?"0"+$("#clockradio-starttime-mm").val():$("#clockradio-starttime-mm").val(),o=1==$("#clockradio-stoptime-hh").val().length?"0"+$("#clockradio-stoptime-hh").val():$("#clockradio-stoptime-hh").val(),s=1==$("#clockradio-stoptime-mm").val().length?"0"+$("#clockradio-stoptime-mm").val():$("#clockradio-stoptime-mm").val(),a=($("#clockradio-start-mon").prop("checked")===!0?"1":"0")+","+($("#clockradio-start-tue").prop("checked")===!0?"1":"0")+","+($("#clockradio-start-wed").prop("checked")===!0?"1":"0")+","+($("#clockradio-start-thu").prop("checked")===!0?"1":"0")+","+($("#clockradio-start-fri").prop("checked")===!0?"1":"0")+","+($("#clockradio-start-sat").prop("checked")===!0?"1":"0")+","+($("#clockradio-start-sun").prop("checked")===!0?"1":"0"),r=($("#clockradio-stop-mon").prop("checked")===!0?"1":"0")+","+($("#clockradio-stop-tue").prop("checked")===!0?"1":"0")+","+($("#clockradio-stop-wed").prop("checked")===!0?"1":"0")+","+($("#clockradio-stop-thu").prop("checked")===!0?"1":"0")+","+($("#clockradio-stop-fri").prop("checked")===!0?"1":"0")+","+($("#clockradio-stop-sat").prop("checked")===!0?"1":"0")+","+($("#clockradio-stop-sun").prop("checked")===!0?"1":"0"),SESSION.json.clkradio_start=e+","+t+","+$("#clockradio-starttime-ampm span").text()+","+a,SESSION.json.clkradio_stop=o+","+s+","+$("#clockradio-stoptime-ampm span").text()+","+r,SESSION.json.clkradio_volume=$("#clockradio-volume").val(),SESSION.json.clkradio_action=$("#clockradio-action span").text(),"Clock Radio"==SESSION.json.clkradio_mode||"Sleep Timer"==SESSION.json.clkradio_mode?($("#clockradio-icon").removeClass("clockradio-off"),$("#clockradio-icon").addClass("clockradio-on")):($("#clockradio-icon").removeClass("clockradio-on"),$("#clockradio-icon").addClass("clockradio-off")),"-1"!=UI.dbEntry[0]?$.getJSON("command/moode.php?cmd=getplitemfile&songpos="+UI.dbEntry[0],function(e){SESSION.json.clkradio_item=e,updateClockRadioCfgSys()}):updateClockRadioCfgSys(),notify("updclockradio")}),$(".btn-appearance-update").click(function(){for(var e=!1,t=!1,a=!1,o=!1,s=!1,r=!1,n=!1,i=!1,l=!1,c=[0,0,0,0],d=0;4>d;d++)"block"==$("#appearance-modal div.control-group").eq(d).css("display")&&(c[d]=1);if(SESSION.json.appearance_modal_state=c[0]+","+c[1]+","+c[2]+","+c[3],SESSION.json.themename!=$("#theme-name span").text()&&(t=!0),SESSION.json.accent_color!=$("#accent-color span").text()&&(t=!0,e=!0),SESSION.json.alphablend!=$("#alpha-blend span").text()&&(t=!0),SESSION.json.adaptive!=$("#adaptive-enabled span").text()&&(t=!0),SESSION.json.cover_backdrop!=$("#cover-backdrop-enabled span").text()&&(t=!0),SESSION.json.cover_blur!=$("#cover-blur span").text()&&(t=!0),SESSION.json.cover_scale!=$("#cover-scale span").text()&&(t=!0),SESSION.json.library_instant_play!=$("#instant-play-action span").text()&&(a=!0),SESSION.json.library_show_genres!=$("#show-genres-column span").text()&&("Yes"==$("#show-genres-column span").text()?$("#top-columns").removeClass("nogenre"):$("#top-columns").addClass("nogenre")),SESSION.json.library_tagview_covers!=$("#show-tagview-covers span").text()&&(a=!0),SESSION.json.library_encoded_at!=getParamOrValue("value",$("#show-encoded-at span").text())&&(l=!0),SESSION.json.library_ellipsis_limited_text!=$("#ellipsis-limited-text span").text()&&("Yes"==$("#ellipsis-limited-text span").text()?$("#library-panel").addClass("limited"):$("#library-panel").removeClass("limited")),SESSION.json.library_thumbnail_columns!=$("#thumbnail-columns span").text()&&setLibraryThumbnailCols($("#thumbnail-columns span").text().substring(0,1)),SESSION.json.library_albumview_sort!=$("#albumview-sort-order span").text().replace("by ","")&&(a=!0),SESSION.json.library_tagview_sort!=$("#tagview-sort-order span").text().replace("by ","")&&(a=!0),SESSION.json.library_comp_id!=$("#compilation-identifier").val()&&(a=!0),SESSION.json.library_recently_added!=getParamOrValue("value",$("#recently-added span").text())&&(a=!0),SESSION.json.library_ignore_articles!=$("#ignore-articles").val()&&(a=!0),SESSION.json.library_utf8rep!=$("#utf8-char-filter span").text()&&(a=!0),SESSION.json.library_hiresthm!=$("#hires-thumbnails span").text()&&(a=!0),SESSION.json.library_covsearchpri!=getParamOrValue("value",$("#cover-search-priority span").text())&&(a=!0),SESSION.json.scnsaver_timeout!=getParamOrValue("value",$("#scnsaver-timeout span").text())&&(o=!0),SESSION.json.scnsaver_style!=$("#scnsaver-style span").text()&&(s=!0),SESSION.json.font_size!=$("#font-size span").text()&&(i=!0),SESSION.json.extra_tags!=$("#extra-tags").val()&&(r=!0),SESSION.json.playhist!=$("#play-history-enabled span").text()&&(n=!0),SESSION.json.themename=$("#theme-name span").text(),SESSION.json.accent_color=$("#accent-color span").text(),SESSION.json.alphablend=$("#alpha-blend span").text(),SESSION.json.adaptive=$("#adaptive-enabled span").text(),SESSION.json.cover_backdrop=$("#cover-backdrop-enabled span").text(),SESSION.json.cover_blur=$("#cover-blur span").text(),SESSION.json.cover_scale=$("#cover-scale span").text(),SESSION.json.library_instant_play=$("#instant-play-action span").text(),SESSION.json.library_show_genres=$("#show-genres-column span").text(),SESSION.json.library_tagview_covers=$("#show-tagview-covers span").text(),SESSION.json.library_encoded_at=getParamOrValue("value",$("#show-encoded-at span").text()),SESSION.json.library_ellipsis_limited_text=$("#ellipsis-limited-text span").text(),SESSION.json.library_thumbnail_columns=$("#thumbnail-columns span").text(),SESSION.json.library_albumview_sort=$("#albumview-sort-order span").text().replace("by ",""),
SESSION.json.library_tagview_sort=$("#tagview-sort-order span").text().replace("by ",""),SESSION.json.library_comp_id=$("#compilation-identifier").val().trim(),SESSION.json.library_recently_added=getParamOrValue("value",$("#recently-added span").text()),SESSION.json.library_ignore_articles=$("#ignore-articles").val().trim(),SESSION.json.library_utf8rep=$("#utf8-char-filter span").text(),SESSION.json.library_hiresthm=$("#hires-thumbnails span").text(),SESSION.json.library_covsearchpri=getParamOrValue("value",$("#cover-search-priority span").text()),SESSION.json.scnsaver_timeout=getParamOrValue("value",$("#scnsaver-timeout span").text()),SESSION.json.scnsaver_style=$("#scnsaver-style span").text(),SESSION.json.font_size=$("#font-size span").text(),SESSION.json.ashuffle_filter=""==$("#ashuffle-filter").val().trim()?"None":$("#ashuffle-filter").val(),SESSION.json.playhist=$("#play-history-enabled span").text(),SESSION.json.extra_tags=$("#extra-tags").val(),1==i&&(setFontSize(),window.dispatchEvent(new Event("resize"))),1==o&&$.get("command/moode.php?cmd=resetscnsaver"),1==e&&(accentColor=themeToColors(SESSION.json.accent_color),$(".playbackknob").trigger("configure",{fgColor:accentColor}),$(".volumeknob").trigger("configure",{fgColor:accentColor})),1==t){themeColor=str2hex(THEME.json[SESSION.json.themename].tx_color),themeBack="rgba("+THEME.json[SESSION.json.themename].bg_color+","+SESSION.json.alphablend+")";var p=splitColor(adaptBack);adaptBack="rgba("+p[0]+","+p[1]+","+p[2]+","+SESSION.json.alphablend+")",themeMcolor=str2hex(THEME.json[SESSION.json.themename].tx_color),tempcolor=THEME.json[SESSION.json.themename].mbg_color.split(","),themeMback="rgba("+tempcolor[0]+","+tempcolor[1]+","+tempcolor[2]+","+themeOp+")",lastYIQ=0,"Yes"==SESSION.json.cover_backdrop&&-1===MPD.json.coverurl.indexOf("default-cover-v6")?($("#cover-backdrop").html('<img class="ss-backdrop" src="'+MPD.json.coverurl+'">'),$("#cover-backdrop").css("filter","blur("+SESSION.json.cover_blur+")"),$("#cover-backdrop").css("transform","scale("+SESSION.json.cover_scale+")")):$("#cover-backdrop").html(""),setColors()}$.post("command/moode.php?cmd=updcfgsystem",{themename:SESSION.json.themename,accent_color:SESSION.json.accent_color,alphablend:SESSION.json.alphablend,adaptive:SESSION.json.adaptive,cover_backdrop:SESSION.json.cover_backdrop,cover_blur:SESSION.json.cover_blur,cover_scale:SESSION.json.cover_scale,library_instant_play:SESSION.json.library_instant_play,library_show_genres:SESSION.json.library_show_genres,library_tagview_covers:SESSION.json.library_tagview_covers,library_encoded_at:SESSION.json.library_encoded_at,library_ellipsis_limited_text:SESSION.json.library_ellipsis_limited_text,library_thumbnail_columns:SESSION.json.library_thumbnail_columns,library_albumview_sort:SESSION.json.library_albumview_sort,library_tagview_sort:SESSION.json.library_tagview_sort,library_comp_id:SESSION.json.library_comp_id,library_recently_added:SESSION.json.library_recently_added,library_ignore_articles:SESSION.json.library_ignore_articles,library_utf8rep:SESSION.json.library_utf8rep,library_hiresthm:SESSION.json.library_hiresthm,library_covsearchpri:SESSION.json.library_covsearchpri,scnsaver_timeout:SESSION.json.scnsaver_timeout,scnsaver_style:SESSION.json.scnsaver_style,font_size:SESSION.json.font_size,ashuffle_filter:SESSION.json.ashuffle_filter,playhist:SESSION.json.playhist,extra_tags:SESSION.json.extra_tags,appearance_modal_state:SESSION.json.appearance_modal_state},function(){r||s||n||a||""!=SESSION.json.bgimage&&"No"==SESSION.json.cover_backdrop||1==UI.bgImgChange?(notify("settings_updated","Auto-refresh in 2 seconds"),setTimeout(function(){location.reload(!0)},2e3)):l?loadLibrary():notify("settings_updated")})}),$("#remove-bgimage").click(function(e){return e.preventDefault(),""!=$("#current-bgimage").html()&&($("#choose-bgimage").show(),$("#remove-bgimage").hide(),$("#current-bgimage").html(""),$("#cover-backdrop").css("background-image",""),$("#info-toggle-bgimage").css("margin-left","5px"),$.post("command/moode.php?cmd=rmbgimage"),UI.bgImgChange=!0),!1}),$("body").on("click",".dropdown-menu .custom-select a",function(){switch($(this).data("cmd")){case"clockradio-mode-sel":$("#clockradio-mode span").text($(this).text()),setClkRadioCtls($(this).text());break;case"clockradio-starttime-ampm":$("#clockradio-starttime-ampm span").text($(this).text());break;case"clockradio-stoptime-ampm":$("#clockradio-stoptime-ampm span").text($(this).text());break;case"clockradio-action-sel":$("#clockradio-action span").text($(this).text());break;case"theme-name-sel":$("#theme-name span").text($(this).text());break;case"accent-color-sel":$("#accent-color span").text($(this).text());break;case"adaptive-enabled-yn":$("#adaptive-enabled span").text($(this).text());break;case"alpha-blend-sel":$("#alpha-blend span").text($(this).text());break;case"cover-backdrop-enabled-yn":$("#cover-backdrop-enabled span").text($(this).text());break;case"cover-blur-sel":$("#cover-blur span").text($(this).text());break;case"instant-play-action-sel":$("#instant-play-action span").text($(this).text());break;case"show-genres-column-yn":$("#show-genres-column span").text($(this).text());break;case"show-tagview-covers-yn":$("#show-tagview-covers span").text($(this).text());break;case"show-encoded-at-sel":$("#show-encoded-at span").text($(this).text());break;case"ellipsis-limited-text-yn":$("#ellipsis-limited-text span").text($(this).text());break;case"thumbnail-columns-sel":$("#thumbnail-columns span").text($(this).text());break;case"tagview-sort-order-sel":$("#tagview-sort-order span").text($(this).text());break;case"albumview-sort-order-sel":$("#albumview-sort-order span").text($(this).text());break;case"recently-added-sel":$("#recently-added span").text($(this).text());break;case"utf8-char-filter-yn":$("#utf8-char-filter span").text($(this).text());break;case"hires-thumbnails-sel":$("#hires-thumbnails span").text($(this).text());break;case"cover-search-priority-sel":$("#cover-search-priority span").text($(this).text());break;case"scnsaver-timeout-sel":$("#scnsaver-timeout span").text($(this).text());break;case"scnsaver-style-sel":$("#scnsaver-style span").text($(this).text());break;case"cover-scale-sel":$("#cover-scale span").text($(this).text());break;case"play-history-enabled-yn":$("#play-history-enabled span").text($(this).text());break;case"font-size-sel":$("#font-size span").text($(this).text())}}),$("#system-restart").click(function(){UI.restart="restart",notify("restart","",8e3),$.get("command/moode.php?cmd=reboot")}),$("#system-shutdown").click(function(){UI.restart="shutdown",notify("shutdown","",8e3),$.get("command/moode.php?cmd=poweroff")}),$(window).on("scroll",function(){UI.mobile&&"panels"==GLOBAL.scriptSection&&-1!=currentView.indexOf("playback")&&($(window).scrollTop()>1&&!showMenuTopW?($("#playback-controls").hide(),$("#container-playlist").css("visibility","visible"),$("#menu-bottom").show(),$("#menu-top").css("height",$("#menu-top").css("line-height")),$("#menu-top").css("backdrop-filter","blur(20px)"),showMenuTopW=!0):UI.mobile&&"0"==$(window).scrollTop()&&($("#container-playlist").css("visibility","hidden"),$("#playback-controls").css("display",""),$("#menu-bottom").hide(),$("#menu-top").css("height","0"),$("#menu-top").css("backdrop-filter",""),showMenuTopW=!1))}),$("#index-genres li").on("click",function(){listLook("genresList li","genres",$(this).text())}),$("#index-artists li").on("click",function(){listLook("artistsList li","artists",$(this).text())}),$("#index-albums li").on("click",function(){className=SESSION.json.library_tagview_sort.toLowerCase().split("/"),"Yes"==SESSION.json.library_tagview_covers?classPrefix="-name-art":classPrefix="-name";var e="."+className[0]+classPrefix;listLook("albumsList li "+e,"albums",$(this).text())}),$("#index-albumcovers li").on("click",function(){var e="."+SESSION.json.library_albumview_sort.toLowerCase()+"-name",t=e.replace(/\/year/g,"");listLook("albumcovers li "+t,"albumcovers",$(this).text())}),$("#index-browse li").on("click",function(){listLook("database li","db",$(this).text())}),$("#index-radio li").on("click",function(){listLook("radiocovers li","radio",$(this).text())}),$("#coverart-url, #playback-switch").click(function(e){return $("#playback-panel").hasClass("cv")?void e.stopImmediatePropagation():($("#coverart-link").hide(),currentView=currentView.split(",")[1],$("#menu-top").css("height","0"),$("#menu-top").css("backdrop-filter",""),$("#menu-bottom, .viewswitch").css("display","flex"),syncTimers(),void("tag"==currentView?(makeActive(".tag-view-btn","#library-panel","tag"),setTimeout(function(){UI.libPos[0]>=0&&customScroll("albums",UI.libPos[0],200)},SCROLLTO_TIMEOUT),GLOBAL.libRendered||loadLibrary()):"album"==currentView?(makeActive(".album-view-btn","#library-panel","album"),setTimeout(function(){UI.libPos[1]>=0&&(customScroll("albumcovers",UI.libPos[1],0),"Hide tracks"==$("#tracklist-toggle").text().trim()&&($("#bottom-row").css("display","flex"),$("#lib-albumcover").css("height","calc(47% - 2em)"),$("#index-albumcovers").hide()))},SCROLLTO_TIMEOUT),GLOBAL.libRendered||loadLibrary()):"radio"==currentView?(makeActive(".radio-view-btn","#radio-panel",currentView),setTimeout(function(){UI.radioPos>=0&&customScroll("radio",UI.radioPos,0)},SCROLLTO_TIMEOUT)):makeActive(".folder-view-btn","#folder-panel","folder")))}),$("#playbar-switch, #playbar-cover, #playbar-title").click(function(){if(!coverView)if(0==currentView.indexOf("playback"))$(window).scrollTop(0);else if(currentView="playback,"+currentView,$.post("command/moode.php?cmd=updcfgsystem",{current_view:currentView}),syncTimers(),setColors(),$("#coverart-link").show(),$("#menu-header").text(""),$("#container-playlist").css("visibility",""),$("#menu-bottom, .viewswitch").css("display","none"),$("#folder-panel, #radio-panel, #library-panel").removeClass("active"),$("#playback-panel").addClass("active"),$("#playback-controls").css("display",""),UI.mobile){showMenuTopW=!1,$(window).scrollTop(0),$("#content").css("height","unset"),$("#container-playlist").css("visibility","hidden");var e=$("#countdown-display").text()?$("#m-countdown").text(e):$("#m-countdown").text("00:00")}else setTimeout(function(){customScroll("pl",parseInt(MPD.json.song),0)},SCROLLTO_TIMEOUT)}),$("#context-backdrop").click(function(){$("#context-backdrop").hide(),$(".context-menu").removeClass("open"),$(".context-menu-lib").removeClass("open")}),$("#appearance-modal .h5").click(function(){$(this).parent().children("div.control-group").slideToggle(100),$(this).parent().children(".dtclose, .dtopen").toggle()});
