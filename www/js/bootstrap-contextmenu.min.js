/*!
 * Bootstrap Context Menu
 * Version: 2.1
 * A small variation of the dropdown plugin by @sydcanem
 * https://github.com/sydcanem/bootstrap-contextmenu
 *
 * New options added by @jeremyhubble for javascript launching
 *  $('#elem').contextmenu({target:'#menu',before:function(e) { return true; } });
 *
 *
 * Twitter Bootstrap (http://twitter.github.com/bootstrap).
 *
 *	TC Moode Audio Player, http://moodeaudio.org
 *	- UI.dbEntry[] from original player code
 * 2018-07-11 TC moOde 4.2
 * - enhance positioning
 * 2020-04-24 TC moOde 6.5.0
 * - @swizzle context menu backdrop
 */

/* =========================================================
 * bootstrap-contextmenu.js
 * =========================================================
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================= */
!function(t){"use strict";var e=function(e,n){this.$element=t(e),this.options=n,this.before=this.options.before||this.before,this.onItem=this.options.onItem||this.onItem,this.options.target&&this.$element.attr("data-target",this.options.target),this.listen()};e.prototype={constructor:e,show:function(e){var n,o,i=t(this);if(!i.is(".disabled, :disabled")&&(o=t.Event("context"),this.before.call(this,e,this.$element))){this.$element.trigger(o),n=this.getMenu();var s=this.getPosition(e,n);return n.attr("style","").css(s).addClass("open"),t("#context-backdrop").show(),!1}},closemenu:function(){this.getMenu().removeClass("open")},before:function(){return!0},onItem:function(){return!0},listen:function(){var e=this;this.$element.on("contextmenu.context.data-api",t.proxy(this.show,this)),t("html").on("click.context.data-api",t.proxy(this.closemenu,this));var n=t(this.$element.attr("data-target"));n.on("click.context.data-api",function(n){e.onItem.call(this,n,t(n.target))}),t("html").on("click.context.data-api",function(e){e.ctrlKey||(n.removeClass("open"),t("#context-backdrop").hide())})},getMenu:function(){var e,n=this.$element.attr("data-target");return n||(n=this.$element.attr("href"),n=n&&n.replace(/.*(?=#[^\s]*$)/,"")),e=t(n)},getPosition:function(e,n){var o,i,s,r=e.clientX,a=e.clientY,c=t(window).width(),h=t(window).height(),l=n.find(".dropdown-menu").outerWidth(),d=n.find(".dropdown-menu").outerHeight(),u={position:"absolute","z-index":9999};return"0.75"==t("body").css("zoom")&&(c=Math.round(1.25*c),h=Math.round(1.25*h),r=Math.round(1.25*r),a=Math.round(1.25*a),d=Math.round(.75*d),l=Math.round(.75*l)),o=a+d>h?{top:a-d+t(window).scrollTop()}:{top:a+t(window).scrollTop()},i=r+l>c&&r-l>0?{left:r-l+t(window).scrollLeft()}:{left:r+t(window).scrollLeft()},s=n.offsetParent().offset(),i.left=i.left-s.left,o.top=o.top-s.top,t.extend(u,o,i)},clearMenus:function(e){e.ctrlKey||t("[data-toggle=context]").each(function(){this.getMenu().removeClass("open"),t("#context-backdrop").hide()})}},t.fn.contextmenu=function(n,o){return this.each(function(){var i=t(this),s=i.data("context"),r="object"==typeof n&&n;s||i.data("context",s=new e(this,r)),"string"==typeof n&&s[n].call(s,o)})},t.fn.contextmenu.Constructor=e,t(document).on("click.context.data-api","[data-toggle=context]",function(e){var n=t(this).offset();UI.dbEntry[1]=n.left,UI.dbEntry[2]=n.top,t(this).contextmenu("show",e),e.preventDefault()})}(window.jQuery);
